(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[27],{8332:function(e,t,s){Promise.resolve().then(s.bind(s,2931))},2931:function(e,t,s){"use strict";s.r(t),s.d(t,{default:function(){return Y}});var a=s(3827),n=s(4090),i=s(8745),r=s(8371),l=s(4562),o=s(7366),c=s(7479),d=s(9251),u=s(1562),h=s(9108),m=s(7805),x=s(4059),p=s(8994),g=s(3441),f=s(3081),v=s(2329),y=s(9014),w=s(8006),b=s(3388),j=s(9990),N=s(6651),S=s(7418),k=s(8009),C=s(3107),P=s(6712);class E{async fetchVoiceAudioBuffer(e,t){return console.log("Fetching audio buffer for: \n".concat(e," \nVoice ID: ").concat(t)),(await this.api({url:this.murfApiUrl,method:"POST",headers:{Authorization:"Bearer ".concat(this.murfApiKey)},data:{text:e,voiceId:t}})).data}async textToSpeech(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.apiKey)throw Error("ElevenLabs API key is required");if(!e.trim())throw Error("Text cannot be empty");let{voice:s=this.defaultVoices.narrator,model:a="eleven_monolingual_v1",stability:n=.5,similarityBoost:i=.75,style:r=0,useSpeakerBoost:l=!0}=t;try{let t=await fetch("".concat(this.baseUrl,"/text-to-speech/").concat(s),{method:"POST",headers:{Accept:"audio/mpeg","Content-Type":"application/json","xi-api-key":this.apiKey},body:JSON.stringify({text:this.cleanTextForTTS(e.trim()),model_id:a,voice_settings:{stability:n,similarity_boost:i,style:r,use_speaker_boost:l}})});if(!t.ok){let e=await t.text();throw Error("TTS API error: ".concat(t.status," - ").concat(e))}return await t.arrayBuffer()}catch(e){throw console.error("Text-to-speech error:",e),e}}async playAudio(e,t){return new Promise((s,a)=>{try{if(this.currentQueueId!==t){s();return}let n=new Blob([e],{type:"audio/mpeg"}),i=URL.createObjectURL(n);this.stopAudio(),this.currentAudio=new Audio(i),this.currentAudio.preload="auto",this.currentAudio.onloadeddata=()=>{console.log("Audio loaded successfully")},this.currentAudio.onplay=()=>{this.isPlaying=!0},this.currentAudio.onended=()=>{this.isPlaying=!1,this.currentQueueId=null,URL.revokeObjectURL(i),s()},this.currentAudio.onerror=e=>{this.isPlaying=!1,this.currentQueueId=null,URL.revokeObjectURL(i),console.error("Audio playback error:",e),a(Error("Audio playback failed"))},this.currentAudio.onpause=()=>{this.isPlaying=!1},this.currentAudio.play().catch(a)}catch(e){console.error("Error creating audio:",e),this.currentQueueId=null,a(e)}})}async speak(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new Promise((s,a)=>{let n={text:e,options:t,resolve:s,reject:a,id:"tts-".concat(Date.now(),"-").concat(Math.random())};this.queue.push(n),console.log("Audio queued:",this.queue),this.processQueue()})}async speakWithVoiceId(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a={voice:t,stability:.6,similarityBoost:.75,style:.2,useSpeakerBoost:!0,...s};return console.log("called speakWithVoiceId()"),this.speak(e,a)}async processQueue(){if(!this.isProcessing&&0!==this.queue.length){for(this.isProcessing=!0;this.queue.length>0;){let{text:e,options:t,resolve:s,reject:a,id:n}=this.queue.shift();try{let a;this.currentQueueId=n,e.length>100&&(a=k.ZP.loading("Generating speech...",{duration:5e3}));let i=await this.textToSpeech(e,t);a&&k.ZP.dismiss(a),this.currentQueueId===n&&await this.playAudio(i,n),s()}catch(e){console.error("TTS processing error:",e),this.currentQueueId===n&&k.ZP.error("Speech generation failed"),this.currentQueueId=null,a(e)}}this.isProcessing=!1}}stopAudio(){this.currentAudio&&(this.currentAudio.pause(),this.currentAudio.currentTime=0,this.isPlaying=!1),this.currentQueueId=null}pauseAudio(){this.currentAudio&&this.isPlaying&&this.currentAudio.pause()}resumeAudio(){this.currentAudio&&!this.isPlaying&&this.currentAudio.play().catch(console.error)}clearQueue(){this.queue.forEach(e=>{let{reject:t}=e;t(Error("Queue cleared"))}),this.queue=[],this.currentQueueId=null,this.stopAudio()}getStatus(){var e,t;return{isPlaying:this.isPlaying,queueLength:this.queue.length,isProcessing:this.isProcessing,currentTime:(null===(e=this.currentAudio)||void 0===e?void 0:e.currentTime)||0,duration:(null===(t=this.currentAudio)||void 0===t?void 0:t.duration)||0}}cleanTextForTTS(e){return e.replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/#{1,6}\s/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/\n{2,}/g,". ").replace(/\n/g," ").replace(/\s{2,}/g," ").replace(/[^\w\s.,!?;:'"()-]/g,"").trim()}async speakCleaned(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=this.cleanTextForTTS(e);return this.speak(s,t)}async speakLongText(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:500,a=this.cleanTextForTTS(e);if(a.length<=s)return this.speak(a,t);let n=a.split(/[.!?]+/).filter(e=>e.trim().length>0),i=[],r="";for(let e of n){let t=e.trim();r.length+t.length+1<=s?r+=(r?". ":"")+t:(r&&i.push(r+"."),r=t)}for(let e of(r&&i.push(r+"."),i))await this.speak(e,t)}isAvailable(){return!!this.apiKey}constructor(){this.baseUrl="https://api.elevenlabs.io/v1",this.murfApiUrl="https://api.murf.ai/v1/speech/generate",this.murfApiKey="ap2_5a73745b-600e-4343-8b1c-bd5f8034fdc5",this.currentAudio=null,this.isPlaying=!1,this.queue=[],this.isProcessing=!1,this.currentQueueId=null,this.api=C.Z.create({adapter:(0,P.setupCache)({maxAge:108e5}).adapter}),this.defaultVoices={teacher:"EXAVITQu4vr4xnSDxMaL",student:"pNInz6obpgDQGcFmaJgB",narrator:"21m00Tcm4TlvDq8ikWAM"},this.apiKey="sk_e30926529c1ec50c9af5ee50f2f17ad788ac0dbe55af3ea9",this.apiKey||console.warn("ElevenLabs API key not found. TTS functionality will be limited.")}}let Z=new E,A=()=>Z.stopAudio(),T=()=>Z.clearQueue(),_=()=>Z.getStatus(),I=()=>Z.isAvailable();var D=s(6964);s(4212);let F=e=>(0,a.jsx)(D.Z,{autoPlay:e.autoplay,src:e.href,className:""});var R=e=>{var t;let{text:s,persona:i="narrator",autoPlay:l,className:o="",onPlayStart:c,onPlayEnd:d,onError:u,node:h}=e,[m,x]=(0,n.useState)(!1),[g,f]=(0,n.useState)(!1),[v,y]=(0,n.useState)(0),[w,b]=(0,n.useState)(0),[j,N]=(0,n.useState)(0);(0,n.useEffect)(()=>{let e=setInterval(()=>{let e=_();x(e.isPlaying),f(e.isProcessing),N(e.currentTime),b(e.duration),e.duration>0&&y(e.currentTime/e.duration*100)},100);return()=>clearInterval(e)},[]),(0,n.useEffect)(()=>{l&&s&&!m&&!g&&S()},[l,s]);let S=async()=>{if(console.log("Play clicked...",s),s)try{f(!0),null==c||c(),null==d||d()}catch(e){console.error("TTS Error:",e),null==u||u(e)}finally{f(!1)}};return(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:"bg-white rounded-lg border border-gray-200 p-4 shadow-sm ".concat(o),children:[(0,a.jsx)("div",{className:"flex items-center space-x-3",children:(0,a.jsx)(F,{href:null!==(t=null==h?void 0:h.data)&&void 0!==t?t:void 0,autoplay:!!l})}),(m||g)&&(0,a.jsx)("div",{className:"mt-2 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"flex items-center space-x-2 text-xs text-gray-500",children:[g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.Z,{className:"h-3 w-3 animate-spin"}),(0,a.jsx)("span",{children:"Generating speech..."})]}),m&&!g&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsxs)("span",{children:["Playing as ",i]})]})]})})]})},q=e=>{let{isPlaying:t,isLoading:s=!1,className:i="",color:l="green",size:o="sm"}=e,c=(0,n.useRef)(null),d=(0,n.useRef)(),{width:u,height:h,bars:m}={sm:{width:60,height:20,bars:12},md:{width:80,height:24,bars:16},lg:{width:100,height:30,bars:20}}[o],[x,p]={green:["#10B981","#059669"],blue:["#3B82F6","#2563EB"],primary:["#6366F1","#4F46E5"]}[l];return((0,n.useEffect)(()=>{let e=c.current;if(!e)return;let a=e.getContext("2d");if(!a)return;e.width=u,e.height=h;let n=u/m,i=Array(m).fill(0).map(()=>.5*Math.random()+.2),r=()=>{a.clearRect(0,0,u,h);let e=a.createLinearGradient(0,0,0,h);e.addColorStop(0,x),e.addColorStop(1,p),a.fillStyle=e;for(let e=0;e<m;e++){if(t&&!s){let t=.4*Math.sin(.01*Date.now()+.5*e)+.4;i[e]=.3+.7*t}else if(s){let t=.2*Math.sin(.005*Date.now()+.3*e)+.4;i[e]=t}else i[e]=Math.max(.95*i[e],.1);let r=i[e]*h,l=e*n,o=h-r,c=n-1;a.fillRect(l,o,c,r)}d.current=requestAnimationFrame(r)};return r(),()=>{d.current&&cancelAnimationFrame(d.current)}},[t,s,u,h,m,x,p]),t)?(0,a.jsx)("div",{className:"flex items-center space-x-1 ".concat(i),children:(0,a.jsx)("div",{className:"flex space-x-0.5",children:[0,1,2].map(e=>(0,a.jsx)(r.E.div,{className:"w-1 bg-gray-400 rounded-full",animate:{height:[4,12,4],opacity:[.4,1,.4]},transition:{duration:.8,repeat:1/0,delay:.1*e,ease:"easeInOut"}},e))})}):(0,a.jsx)(r.E.canvas,{ref:c,className:"rounded ".concat(i),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{duration:.3},style:{width:u,height:h}})},L=e=>{let{isPlaying:t,isLoading:s,isMuted:n,className:i="",size:r="sm",showWaveform:l=!0,color:o="green"}=e,c={sm:"w-4 h-4",md:"w-5 h-5",lg:"w-6 h-6"};return s?(0,a.jsxs)("div",{className:"flex items-center space-x-2 ".concat(i),children:[(0,a.jsx)(p.Z,{className:"".concat(c[r]," animate-spin text-primary-500")}),l&&(0,a.jsx)(q,{isPlaying:!1,isLoading:!0,size:r,color:o}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Loading..."})]}):n?(0,a.jsxs)("div",{className:"flex items-center space-x-2 ".concat(i),children:[(0,a.jsx)(u.Z,{className:"".concat(c[r]," text-gray-400")}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Muted"})]}):t?(0,a.jsxs)("div",{className:"flex items-center space-x-2 ".concat(i),children:[(0,a.jsx)(d.Z,{className:"".concat(c[r]," text-green-500")}),l&&(0,a.jsx)(q,{isPlaying:!0,isLoading:!1,size:r,color:o}),(0,a.jsx)("span",{className:"text-xs text-green-600",children:"Playing"})]}):(0,a.jsxs)("div",{className:"flex items-center space-x-2 ".concat(i),children:[(0,a.jsx)(d.Z,{className:"".concat(c[r]," text-gray-400")}),(0,a.jsx)("span",{className:"text-xs text-gray-400",children:"Ready"})]})},M=s(8222),U=s(7907),B=s(6782),O=s(2273);class Q{cleanTextForTTS(e){return e.replace(/\*\*(.*?)\*\*/g,"$1").replace(/\*(.*?)\*/g,"$1").replace(/`(.*?)`/g,"$1").replace(/#{1,6}\s/g,"").replace(/\[([^\]]+)\]\([^)]+\)/g,"$1").replace(/\n{2,}/g,". ").replace(/\n/g," ").replace(/\s{2,}/g," ").replace(/[^\w\s.,!?;:'"()-]/g,"").trim()}async fetchVoiceAudioBuffer(){var e,t,s;console.log("Fetching audio buffer for: \n".concat(this.text," \nVoice ID: ").concat(null===(e=this.persona.voice)||void 0===e?void 0:e.id)),this.loading=!0;try{let e=await fetch(this.murfApiUrl,{method:"POST",headers:{"api-key":this.murfApiKey,"Content-Type":"Application/json"},body:JSON.stringify({text:this.cleanTextForTTS(this.text),voiceId:null!==(s=null===(t=this.persona.voice)||void 0===t?void 0:t.id)&&void 0!==s?s:"en-US-natalie"}),cache:"force-cache"});if(!e.status.toString().startsWith("2"))throw Error("Error fetching audio buffer");let a=await e.json();return this.loading=!1,null==a?void 0:a.audioFile}catch(e){throw this.loading=!1,Error("Error fetching audio buffer: ".concat(e))}}async play(){try{if(this.playing=!0,this.fetched&&this.data||await this.fetch(),console.log("After fetch in play:",this.loading),this.loading)return!1;if(this.audioRef.current&&this.data)return this.audioRef.current.src=this.data,await this.audioRef.current.play(),await new Promise((e,t)=>{let s=this.audioRef.current;s.onended=null,s.onerror=null;let a=()=>{i(),e()},n=e=>{i(),t(e)},i=()=>{s.removeEventListener("ended",a),s.removeEventListener("error",n)};s.addEventListener("ended",a),s.addEventListener("error",n)}),this.played=!0,this.playing=!1,!0;return!1}catch(e){return console.log("Error while playing audio: ".concat(e)),this.playing=!1,!1}}async fetch(){let e=await this.fetchVoiceAudioBuffer();e&&(this.data=e,this.fetched=!0)}pause(){var e;null===(e=this.audioRef.current)||void 0===e||e.pause(),this.played=!0,this.playing=!1}setNext(e){this.next=e}getNext(){return this.next}constructor(e,t,s,a,n,i=null,r=!1,l=!1,o=!1,c=null,d=!1,u="https://api.murf.ai/v1/speech/generate",h="ap2_5a73745b-600e-4343-8b1c-bd5f8034fdc5"){this.id=e,this.text=t,this.persona=s,this.timestamp=a,this.audioRef=n,this.next=i,this.loading=r,this.playing=l,this.fetched=o,this.data=c,this.played=d,this.murfApiUrl=u,this.murfApiKey=h}}class z{async autoplay(){if(!this.autoplayon||!this.queue.length)return!1;this.current=this.queue[0],await this.current.play();let e=this.current.getNext();for(;this.autoplayon&&e;)await e.play()}async playNode(e){await e.play()}stopPlay(){var e,t;let s=this.current;if(null===(e=this.audioRef.current)||void 0===e||e.pause(),s)return null===(t=this.current)||void 0===t||t.pause(),this.current=null,s}enqueue(e){let t=new Q(e._id,e.data,e.persona,e.timestamp,this.audioRef);return this.queue.push(t),this.queue.length>1&&this.queue[this.queue.length-2].setNext(t),t}dequeue(){return this.queue.pop()}seek(e){this.current=e}constructor(e=[],t=null,s=[],a,n=!0){this.data=e,this.current=t,this.queue=s,this.audioRef=a,this.autoplayon=n,this.data.map(e=>{let t=new Date(e.createdAt);return this.enqueue({...null!=e?e:{},data:e.body,persona:e.persona,timestamp:t})})}}var K=s(6210),W=s(3368);let V=e=>{var t,s,i,r,l;let{node:o,currentNode:c,handlePlay:d,handlePause:u}=e,h=(null==c?void 0:c.id)==(null==o?void 0:o.id),[m,x]=(0,n.useState)(o);return(0,n.useEffect)(()=>{h&&x(c)},[c]),(0,a.jsxs)("div",{className:"flex-1 max-w-md",children:[(0,a.jsxs)("div",{className:"rounded-lg p-3 ".concat((null==o?void 0:null===(t=o.persona)||void 0===t?void 0:t.isUser)?"bg-primary-500 text-white":(null==o?void 0:null===(s=o.persona)||void 0===s?void 0:s.role)==="teacher"?"bg-gray-100":"bg-secondary-50"),children:[(0,a.jsxs)("div",{className:"flex items-center mb-1",children:[(0,a.jsx)("span",{className:"text-xs font-medium ".concat((null==o?void 0:null===(i=o.persona)||void 0===i?void 0:i.isUser)?"text-primary-100":"text-gray-600"),children:null==o?void 0:null===(r=o.persona)||void 0===r?void 0:r.name}),"teacher"==o.persona.role&&(0,a.jsx)(W.Z,{className:"ml-2 text-purple-600",fontSize:"14px",width:"14px",height:"14px"})]}),(0,a.jsx)("p",{className:"text-sm leading-relaxed",children:null==o?void 0:o.text})]}),(0,a.jsx)(N.Z,{variant:"ghost",size:"sm",onClick:()=>{if(m.loading)return},disabled:m.loading,className:"w-6 h-6 p-0 rounded-full hover:bg-gray-100 flex items-center justify-center focus:border-none",icon:(console.log("Getting Icon for Node:",m),h&&m.loading&&!m.playing)?(0,a.jsx)(p.Z,{className:"h-3 w-3 animate-spin text-primary-500"}):h&&m.playing?(console.log("return playing..."),(0,a.jsx)(K.Z,{className:"h-3 w-3 text-green-600",onClick:async()=>{u(o)}})):!m.playing&&m.played?(0,a.jsx)(f.Z,{onClick:async()=>{d(o)},className:"h-3 w-3 text-gray-600"}):(0,a.jsx)(f.Z,{onClick:async()=>{d(o)},className:"h-3 w-3 text-blue-600"})}),(0,a.jsx)("p",{className:"text-xs mt-1 ".concat((null==o?void 0:null===(l=o.persona)||void 0===l?void 0:l.isUser)?"text-right text-gray-400":"text-gray-500"),children:o.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})},G=n.lazy(()=>s.e(245).then(s.bind(s,7245)));var $=()=>{var e;let[t,s]=(0,n.useState)("reading"),[C,P]=(0,n.useState)(0),[E,Z]=(0,n.useState)(!0),[_,D]=(0,n.useState)(!1),{session:F}=(0,O.C)(),{id:q}=(0,U.useParams)(),[K,W]=(0,n.useState)(),[$,J]=(0,n.useState)(),[Y,H]=(0,n.useState)(!1),[X,ee]=(0,n.useState)([]),[et,es]=(0,n.useState)(""),[ea,en]=(0,n.useState)(!1),[ei,er]=(0,n.useState)(!1),[el,eo]=(0,n.useState)(!1),[ec,ed]=(0,n.useState)(!0),[eu,eh]=(0,n.useState)(),[em,ex]=(0,n.useState)(),[ep,eg]=(0,n.useState)(),[ef,ev]=(0,n.useState)(null),[ey,ew]=(0,n.useState)(),[eb,ej]=(0,n.useState)(!1),[eN,eS]=(0,n.useState)("disconnected"),[ek,eC]=(0,n.useState)([]),[eP,eE]=(0,n.useState)(null),{session:eZ}=(0,O.C)(),[eA,eT]=(0,n.useState)(),[e_,eI]=(0,n.useState)(),[eD,eF]=(0,n.useState)(!0),[eR,eq]=(0,n.useState)(null),[eL,eM]=(0,n.useState)(!1),eU=(0,n.useRef)(null),eB=(0,n.useRef)(),eO=(0,n.useRef)(),[eQ,ez]=(0,n.useState)([]),[eK,eW]=(0,n.useState)(),eV=(0,n.useRef)(),eG=(0,n.useRef)();(0,n.useEffect)(()=>{console.log("Start discussion loading changed:",eb)},[eb]);let e$=(0,n.useCallback)(e=>{eq(e),console.log("Called Play start witj::",e)},[eD]),eJ=(0,n.useCallback)(e=>{eq(e)},[eD]),eY=(0,n.useCallback)(e=>{eq(e)},[eD]),eH=(0,n.useCallback)(e=>{eq(e)},[eD]),eX=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:8;return Math.floor(Math.random()*10**e)};(0,n.useEffect)(()=>{if(ep){eW(void 0);let e=new Q(ep._id,ep.body,{_id:null==F?void 0:F._id,id:eX().toString(),name:"".concat(null==F?void 0:F.firstName," ").concat(null==F?void 0:F.lastName),role:"student",isUser:!0},new Date,eG);e.fetch().then(()=>{eW(e)})}},[ep]);let{nodes:e0,addNode:e1,startAutoplay:e2,playNode:e4,stopPlay:e3}=function(e){let{autoplay:t=!0,messages:s,audioRef:a,onPlaystop:i,onPlaystart:r,onFetchstart:l,onFetchstop:o}=e,[c,d]=(0,n.useState)(null),[u,h]=(0,n.useState)(!1),m=(0,n.useRef)(new z(s.map(e=>({...e})),null,[],a)),[x,p]=(0,n.useState)([]);(0,n.useEffect)(()=>{p(m.current.queue)},[m.current.queue]);let g=(0,n.useCallback)(e=>{let t=new Date(e.createdAt);return m.current.enqueue({...e,data:e.body,timestamp:t})},[]);(0,n.useEffect)(()=>{m.current=new z(s.map(e=>({...e})),null,[],a,t)},[s]);let f=(0,n.useCallback)(async e=>{d(e),h(!0),e.fetched||(e.loading=!0,l(e),await e.fetch(),e.loading=!1,o(e)),e.data&&a.current&&(a.current.src=e.data,e.playing=!0,r(e),await a.current.play(),e.played=!0),i(e)},[]),v=(0,n.useCallback)(async()=>{let e=m.current.queue;if(!e.length)return;let s=e[0];for(;s;)console.log({node:s,autoplay:t}),console.log("Playing node (auto-mode):",s),await f(s),await new Promise(e=>{if(!a.current)return e();a.current.onended=()=>e()}),s=s.getNext()||null;h(!1)},[f]),y=(0,n.useCallback)(()=>{a.current&&(a.current.pause(),a.current.currentTime=0),h(!1);let e=m.current.stopPlay();e&&i(e)},[]);return(0,n.useEffect)(()=>{t&&m.current.autoplay()},[t]),{nodes:x,currentNode:c,isPlaying:u,addNode:g,playNode:f,startAutoplay:v,stopPlay:y,audioRef:a}}({messages:X,audioRef:eV,autoplay:eD,onPlaystart:e$,onPlaystop:eJ,onFetchstart:eY,onFetchstop:eH});function e5(e){eq(e),e4(e)}function e6(){eq(null),e3()}(0,n.useEffect)(()=>{(null==e0?void 0:e0.length)&&ez(e0)},[e0]);let e8=(0,n.useCallback)(()=>{eU.current&&eU.current.scrollIntoView({behavior:"smooth",block:"end",inline:"nearest"})},[]);(0,n.useEffect)(()=>{let e=setTimeout(e8,100);return()=>clearTimeout(e)},[X,e8]),(0,n.useEffect)(()=>{console.log("node changed:",eR)},[eR]),(0,n.useEffect)(()=>{if(console.log({discussionAutoplay:eD,nowPlaying:e_,discussionCurrentNode:eR},"be"),eD&&!e_){if(eR)eI(eR.id);else if(eQ.length){let e=eQ.find(e=>!e.played);console.log({firstUnplayed:e}),e&&(eq(e),console.log("first unplayed node set"),e2().then(()=>{console.log("autoplay done")}).catch(e=>{console.log("Autoplay Error:",e)}))}}},[eD,eQ]),(0,n.useEffect)(()=>{console.log("Channel ID changed")}),(0,n.useEffect)(()=>{var e,t;if(console.log("Will init socket?",(null==eZ?void 0:null===(e=eZ.user)||void 0===e?void 0:e._id)&&ey&&!ef),(null==eZ?void 0:null===(t=eZ.user)||void 0===t?void 0:t._id)&&ey&&!ef){eS("connecting");let e=(0,B.io)("http://localhost:5000",{transports:["websocket","polling"],timeout:1e4,reconnection:!0,reconnectionAttempts:5,reconnectionDelay:1e3});return e.on("connect",()=>{console.log("Socket connected:",e.id),eS("connected"),ev(e),e.emit("join_discussion",{channel:ey}),ek.length>0&&(ek.forEach(t=>{e.emit("user_message",{channel:ey,body:t})}),eC([]))}),e.on("disconnect",()=>{console.log("Socket disconnected"),eS("disconnected"),ev(null)}),e.on("connect_error",e=>{console.error("Socket connection error:",e),eS("disconnected"),k.ZP.error("Connection error. Retrying...")}),e.on("message",e=>{var t,s,a;if(console.log("Received message:",e),ej(!1),en(!1),null==e?void 0:null===(t=e.data)||void 0===t?void 0:t.data){let t=e.data.data;if(null===(s=t.persona)||void 0===s?void 0:s.isUser)return;!K||(null==K?void 0:K.discussionStarted)||(W({...K,discussionStarted:!0}),H(!0)),e1(t),ec&&t.persona&&!t.persona.isUser&&(null===(a=t.persona.voice)||void 0===a?void 0:a.id)&&I()&&setTimeout(()=>{},500)}}),()=>{e.disconnect(),ev(null),eS("disconnected")}}},[null==eZ?void 0:null===(e=eZ.user)||void 0===e?void 0:e._id,ey,eL]),(0,n.useEffect)(()=>{"disconnected"!=eN&&ef||(console.log("Selected channel for discussion...",K),eM(!eL)),"connected"==eN&&ef&&ey&&ef.emit("join_discussion",{channel:ey})},[eN,ey]),(0,n.useEffect)(()=>{(null==eZ?void 0:eZ.user)&&eT(eZ.user)},[eZ]),(0,n.useEffect)(()=>{ec||(A(),T(),eE(null))},[ec]),(0,n.useEffect)(()=>{A(),T(),eE(null),ee([])},[null==K?void 0:K._id]),(0,n.useEffect)(()=>{A(),T(),eE(null)},[t]);let e7=(0,n.useCallback)(async()=>{try{let e=await M.av.getChapters(q);e&&(eh(e),$||J(e[0]),K||W(e[0]))}catch(e){console.error("Error fetching chapters:",e),k.ZP.error("Failed to load chapters")}},[q,$,K]),e9=(0,n.useCallback)(async()=>{if($)try{let e=await M.av.getSections(q,$.index);e&&(ex(e),ep&&ep.chapter===$.index||(eg(e[0]),P(0)))}catch(e){console.error("Error fetching sections:",e),k.ZP.error("Failed to load sections")}},[q,$,ep]);(0,n.useEffect)(()=>{e7()},[e7]),(0,n.useEffect)(()=>{e9()},[e9]);let te=(0,n.useCallback)(async()=>{if(K)try{let s=await M.av.getDiscussions(q,K._id);if(null==s?void 0:s._id){var e,t;console.log({channelId:ey,ap_id:null==s?void 0:s._id}),console.log("Lets update channel ID to:",null==s?void 0:s._id),ew(null==s?void 0:s._id),(null===(e=s.messages)||void 0===e?void 0:e.length)&&(ee(s.messages),!eP&&(null==s?void 0:null===(t=s.messages)||void 0===t?void 0:t.find(e=>{var t;return!(null==e?void 0:null===(t=e.persona)||void 0===t?void 0:t.isUser)}))&&setTimeout(()=>{},500))}else ee([])}catch(e){console.error("Error fetching discussion:",e),k.ZP.error("Failed to load discussion")}},[K]);(0,n.useEffect)(()=>{"discussion"===t&&te()},[t,te]);let tt=(0,n.useCallback)(()=>{if(null==em?void 0:em.length){let e=em[C+1];e&&(eg(e),P(C+1))}},[em,C]),ts=(0,n.useCallback)(()=>{if(null==em?void 0:em.length){let e=em[C-1];e&&(eg(e),P(C-1))}},[em,C]),ta=(0,n.useCallback)(e=>{let s=null==eu?void 0:eu.find(t=>t.index===e);s&&("reading"===t?J(s):W(s))},[eu,t]),tn=(0,n.useCallback)(async()=>{if(!K){k.ZP.error("Please select a chapter first");return}console.log("True setter 1..."),ej(!0);let e=await M.av.createDiscussion(q,null==K?void 0:K._id);console.log("New discussion generated..."),(null==e?void 0:e._id)&&ew(null==e?void 0:e._id),console.log("discussion updated");try{await new Promise((e,t)=>{let s=0,a=setInterval(()=>{if(s+=1e3,ef&&"connected"===eN){clearInterval(a),e(!0);return}if(s>=15e3){console.log("Socket connection timeout"),clearInterval(a),t(Error("Socket connection timeout"));return}console.log("Waiting for socket connection... ".concat(s,"ms elapsed"))},1e3)})}catch(e){ej(!1),k.ZP.error("Connection timeout"),console.log("Connection error: ".concat(e))}try{ef&&"connected"===eN&&(console.log("Emmitting start_discussion"),ef.emit("start_discussion",{docId:q,chapter:K._id,channel:ey}))}catch(e){console.error("Error starting discussion:",e),k.ZP.error("Failed to start discussion"),ej(!1)}},[ef,eN,K,q]),ti=(0,n.useCallback)(()=>{if(!et.trim())return;let e=et.trim(),t="temp-".concat(Date.now(),"-").concat(Math.random());es("");let s={_id:t,body:e,persona:{id:(null==eA?void 0:eA._id)||"",_id:(null==eA?void 0:eA._id)||"",name:"".concat(null==eA?void 0:eA.firstName," ").concat(null==eA?void 0:eA.lastName)||"You",role:"student",isUser:!0},sent:!1,createdAt:new Date().toISOString(),isOptimistic:!0,tempId:t};ee(e=>[...e,s]),ef?(console.log("Found global socket, hence, emmiting message...",{channel:ey,body:e}),ef.emit("user_message",{channel:ey,body:e}),en(!0),setTimeout(()=>en(!1),3e3)):(eC(t=>[...t,e]),ee(e=>e.filter(e=>e.tempId!==t)),k.ZP.error("Message queued. Reconnecting..."))},[et,ef,eN,ey,eA]),tr=(0,n.useCallback)(()=>{D(!0)},[]),tl=(0,n.useCallback)(()=>{D(!1)},[]),to=(0,n.useCallback)(e=>{k.ZP.error("Speech generation failed"),D(!1),console.log("Failed to generate speech:",e)},[]),tc=(0,n.useCallback)(()=>{ed(!ec),ec?(A(),T(),eE(null),k.ZP.success("Audio disabled")):I()?k.ZP.success("Audio enabled for discussions"):k.ZP.error("Text-to-speech is not available. Please check your API configuration.")},[ec]);return(0,n.useEffect)(()=>{if(console.log("I am running...",eP),ec){let e=X.find(e=>!e.persona.isUser);console.log("Playing next:",e),e&&eE(null==e?void 0:e._id)}},[ec]),(0,n.useEffect)(()=>()=>{eB.current&&clearTimeout(eB.current),eO.current&&clearTimeout(eO.current),A(),T()},[]),(0,a.jsxs)("div",{className:"flex flex-col h-screen bg-gray-50",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 p-4 flex-shrink-0",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-xl sm:text-2xl font-bold text-gray-900",children:"AI Classroom"}),(0,a.jsx)("p",{className:"text-sm sm:text-base text-gray-600",children:"Interactive Learning Experience"})]}),(0,a.jsxs)("div",{className:"flex flex-wrap sm:flex-nowrap items-center space-x-0 sm:space-x-2 space-y-2 sm:space-y-0 bg-gray-100 rounded-lg p-1 w-full sm:w-auto",children:[(0,a.jsxs)("button",{onClick:()=>s("reading"),className:"flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 ".concat("reading"===t?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,a.jsx)(l.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Reading"})]}),(0,a.jsxs)("button",{onClick:()=>s("discussion"),className:"flex-1 sm:flex-none px-4 py-2 rounded-md text-sm font-medium transition-colors flex items-center justify-center space-x-2 ".concat("discussion"===t?"bg-white text-primary-600 shadow-sm":"text-gray-600 hover:text-gray-900"),children:[(0,a.jsx)(o.Z,{className:"h-4 w-4"}),(0,a.jsx)("span",{children:"Discussion"})]})]})]})}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden",children:(0,a.jsxs)(i.M,{mode:"wait",children:["reading"===t&&(0,a.jsxs)(r.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full flex flex-col",children:[(0,a.jsxs)("div",{className:"bg-white border-b border-gray-200 p-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between mb-4 gap-4",children:[(0,a.jsxs)("div",{className:"sm:max-w-[40%]",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold text-gray-900 truncate hidden sm:block",children:null==$?void 0:$.title}),(0,a.jsx)("div",{className:"sm:hidden",children:(0,a.jsx)("select",{value:(null==$?void 0:$.index)||"",onChange:e=>ta(parseInt(e.target.value)),className:"w-full px-3 bg-white py-2 border border-gray-200 rounded-md text-sm focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-primary-500",children:null==eu?void 0:eu.map((e,t)=>(0,a.jsxs)("option",{value:e.index,children:["Chapter ",t+1,": ",e.title]},e._id))})}),(0,a.jsxs)("p",{className:"text-gray-600",children:["Section ",C+1," of ",null==em?void 0:em.length,": ",null==ep?void 0:ep.title]})]}),(0,a.jsx)("div",{className:"hidden sm:block sm:max-w-[55%]",children:(0,a.jsx)("div",{className:"flex items-center space-x-2 overflow-x-auto scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 pb-2",children:null==eu?void 0:eu.map((e,t)=>(0,a.jsxs)("button",{onClick:()=>ta(e.index),className:"flex-shrink-0 px-3 py-1 rounded-md text-sm font-medium transition-colors ".concat(e.index===(null==$?void 0:$.index)?"bg-primary-100 text-primary-700":"text-gray-600 hover:text-gray-900 hover:bg-gray-100"),children:["Ch ",t+1]},e._id))})})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-3",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,a.jsx)(N.Z,{variant:E?"primary":"outline",size:"sm",onClick:()=>Z(!E),icon:(0,a.jsx)(c.Z,{className:"h-4 w-4"}),children:E?"Exit Auto-Read":"Auto-Read Mode"}),!E&&(0,a.jsx)(N.Z,{variant:"ghost",size:"sm",onClick:tc,icon:ec?(0,a.jsx)(d.Z,{className:"h-4 w-4"}):(0,a.jsx)(u.Z,{className:"h-4 w-4"}),children:ec?"Audio On":"Audio Off"}),!I()&&(0,a.jsx)("div",{className:"text-xs text-yellow-600 bg-yellow-50 px-2 py-1 rounded",children:"TTS not configured"})]}),_&&(0,a.jsx)(L,{isPlaying:!0,isLoading:!1,isMuted:!1,size:"md",showWaveform:!0,color:"primary"})]})]}),(0,a.jsx)("div",{className:"flex-1 overflow-y-auto p-2 sm:p-6",children:(0,a.jsx)(S.Zb,{className:"max-w-4xl mx-auto w-full",children:(0,a.jsxs)(S.aY,{className:"p-4 sm:p-8",children:[(0,a.jsx)("h3",{className:"text-xl sm:text-2xl font-bold text-gray-900 mb-4 sm:mb-6",children:null==ep?void 0:ep.title}),(0,a.jsx)("div",{className:"prose max-w-none mb-4 sm:mb-6",children:(0,a.jsx)("div",{className:"text-gray-800 leading-relaxed text-base sm:text-lg",children:(0,a.jsx)(G,{children:(null==ep?void 0:ep.body)||""})})}),ec&&ep&&I()&&(0,a.jsx)(R,{text:ep.body,persona:"narrator",onPlayStart:tr,onPlayEnd:tl,onError:to,node:null!=eK?eK:void 0,className:"mt-4 sm:mt-6",autoPlay:E})]})})}),(0,a.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,a.jsx)("div",{className:"bg-white border-t border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex items-center justify-between max-w-4xl mx-auto",children:[(0,a.jsx)(N.Z,{variant:"outline",onClick:ts,disabled:0===C,icon:(0,a.jsx)(h.Z,{className:"h-4 w-4"}),children:"Previous"}),(0,a.jsx)("div",{className:"flex items-center space-x-2",children:null==em?void 0:em.map((e,t)=>(0,a.jsx)("button",{onClick:()=>{eg(em[t]),P(t)},className:"w-3 h-3 rounded-full transition-colors ".concat(t===C?"bg-primary-500":t<C?"bg-primary-300":"bg-gray-300")},t))}),(0,a.jsx)(N.Z,{onClick:tt,disabled:!(null==em?void 0:em.length)||C===em.length-1,icon:(0,a.jsx)(m.Z,{className:"h-4 w-4"}),children:"Next"})]})})})]},"reading"),"discussion"===t&&(0,a.jsxs)(r.E.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{duration:.3},className:"h-full flex flex-col",children:[(0,a.jsx)("div",{className:"bg-white border-b border-gray-200 p-4",children:(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center sm:space-x-4 gap-2 sm:gap-0",children:[(0,a.jsx)("div",{className:"bg-primary-100 p-2 rounded-lg self-start sm:self-auto",children:(0,a.jsx)(x.Z,{className:"h-6 w-6 text-primary-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h2",{className:"text-lg sm:text-xl font-semibold text-gray-900",children:"Live Discussion"}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("p",{className:"text-sm sm:text-base text-gray-600",children:"Interactive AI Classroom"}),"connected"===eN&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-xs text-green-600",children:"Connected"})]}),"connecting"===eN&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(p.Z,{className:"w-3 h-3 animate-spin text-yellow-500"}),(0,a.jsx)("span",{className:"text-xs text-yellow-600",children:"Connecting..."})]}),"disconnected"===eN&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),(0,a.jsx)("span",{className:"text-xs text-red-600",children:"Disconnected"})]})]})]})]}),(0,a.jsxs)("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-3 sm:gap-4",children:[(0,a.jsxs)("div",{className:"relative w-full sm:w-auto",children:[(0,a.jsx)("select",{value:(null==K?void 0:K._id)||"",onChange:e=>{let t=null==eu?void 0:eu.find(t=>t._id===e.target.value);t&&W(t)},className:"w-full sm:w-auto appearance-none bg-white border border-gray-300 rounded-lg px-4 py-2 pr-8 text-sm font-medium text-gray-700 hover:border-gray-400 focus:outline-none focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:null==eu?void 0:eu.map(e=>(0,a.jsx)("option",{value:e._id,children:e.title},e._id))}),(0,a.jsx)(g.Z,{className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-4 w-4 text-gray-400 pointer-events-none"})]}),!X.length&&(0,a.jsx)(N.Z,{onClick:tn,disabled:eb||"connected"!==eN,loading:eb,icon:eb?(0,a.jsx)(p.Z,{className:"h-4 w-4 animate-spin"}):(0,a.jsx)(f.Z,{className:"h-4 w-4"}),className:"w-full sm:w-auto bg-gradient-to-r from-primary-600 to-accent-600",children:eb?"Starting...":"Start Discussion"}),Y&&(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(N.Z,{variant:"ghost",size:"sm",onClick:()=>eF(!eD),icon:eD?(0,a.jsx)("div",{className:"rounded-full bg-blue-100 text-blue-600",children:(0,a.jsx)(v.Z,{className:"h-4 w-4"})}):(0,a.jsx)(v.Z,{className:"h-4 w-4 text-gray-600"})}),!I()&&ec&&(0,a.jsx)("div",{className:"text-xs text-yellow-600 bg-yellow-50 px-2 py-1 rounded",children:"TTS not configured"}),(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-green-500 rounded-full animate-pulse"}),(0,a.jsx)("span",{className:"text-xs text-gray-500",children:"Live"})]})]})]})]})}),(null==K?void 0:K.discussionStarted)?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[(0,a.jsxs)(i.M,{initial:!1,children:[eQ.map(e=>(0,a.jsx)(V,{handlePlay:e5,handlePause:e6,currentNode:eR,node:e},e.id)),(0,a.jsx)("audio",{className:"hidden",ref:eV})]}),ea&&(0,a.jsxs)(r.E.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},className:"flex items-center space-x-3",children:[(0,a.jsx)("div",{className:"w-10 h-10 rounded-full bg-gray-100 flex items-center justify-center",children:(0,a.jsx)("div",{className:"w-6 h-6 rounded-full bg-gray-300 animate-pulse"})}),(0,a.jsxs)("div",{className:"bg-gray-100 rounded-lg p-3 flex items-center space-x-2",children:[(0,a.jsxs)("div",{className:"flex space-x-1",children:[(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce"}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.1s"}}),(0,a.jsx)("div",{className:"w-2 h-2 bg-gray-400 rounded-full animate-bounce",style:{animationDelay:"0.2s"}})]}),(0,a.jsx)("span",{className:"text-sm text-gray-500",children:"Someone is typing..."})]})]}),(0,a.jsx)("div",{ref:eU})]}),(0,a.jsxs)("div",{className:"border-t border-gray-200 p-4 bg-white",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2 mb-3",children:[(0,a.jsx)(N.Z,{variant:el?"primary":"outline",size:"sm",onClick:()=>eo(!el),icon:(0,a.jsx)(y.Z,{className:"h-4 w-4"}),children:el?"Hand Raised":"Raise Hand"}),(0,a.jsx)(N.Z,{variant:ei?"danger":"outline",size:"sm",onClick:()=>er(!ei),icon:ei?(0,a.jsx)(w.Z,{className:"h-4 w-4"}):(0,a.jsx)(b.Z,{className:"h-4 w-4"}),children:ei?"Mute":"Unmute"}),ek.length>0&&(0,a.jsxs)("div",{className:"text-xs text-yellow-600 bg-yellow-50 px-2 py-1 rounded",children:[ek.length," message(s) queued"]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)("input",{type:"text",value:et,onChange:e=>es(e.target.value),placeholder:"connected"===eN?"Join the discussion...":"Connecting...",className:"flex-1 px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent text-sm disabled:bg-gray-100 disabled:cursor-not-allowed",onKeyDown:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ti())},disabled:"connected"!==eN,maxLength:500}),(0,a.jsx)(N.Z,{size:"sm",onClick:ti,disabled:!et.trim()||"connected"!==eN,icon:(0,a.jsx)(j.Z,{className:"h-4 w-4"})})]}),(0,a.jsxs)("div",{className:"flex justify-between items-center mt-2",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4 text-xs text-gray-500",children:[(0,a.jsxs)("span",{children:["connected"===eN&&"Connected to live discussion","connecting"===eN&&"Connecting to discussion...","disconnected"===eN&&"Disconnected - messages will be queued"]}),ec&&I()&&(0,a.jsxs)("div",{className:"flex items-center space-x-1",children:[(0,a.jsx)(d.Z,{className:"h-3 w-3 text-green-500"}),(0,a.jsx)("span",{className:"text-green-600",children:"Audio enabled"})]})]}),(0,a.jsxs)("p",{className:"text-xs text-gray-400",children:[et.length,"/500"]})]})]})]}):(0,a.jsx)("div",{className:"flex-1 flex items-center justify-center p-6",children:(0,a.jsx)(S.Zb,{className:"max-w-md mx-auto",children:(0,a.jsxs)(S.aY,{className:"p-8 text-center",children:[(0,a.jsx)("div",{className:"bg-primary-100 w-16 h-16 rounded-2xl flex items-center justify-center mx-auto mb-4",children:(0,a.jsx)(o.Z,{className:"h-8 w-8 text-primary-600"})}),(0,a.jsx)("h3",{className:"text-xl font-bold text-gray-900 mb-2",children:"Ready to Discuss?"}),(0,a.jsx)("p",{className:"text-gray-600 mb-6",children:'Select a chapter above and click "Start Discussion" to begin an interactive AI classroom session.'}),(0,a.jsxs)("p",{className:"text-sm text-gray-500 mb-4",children:["Current chapter: ",(0,a.jsx)("span",{className:"font-medium",children:null==K?void 0:K.title})]}),eb&&(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center mt-6",children:[(0,a.jsx)("div",{className:"w-10 h-10 border-4 border-primary-200 border-t-primary-600 rounded-full animate-spin mb-3"}),(0,a.jsx)("p",{className:"text-primary-600 font-medium",children:"Preparing discussion..."}),(0,a.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"This may take a few moments"})]}),"disconnected"===eN&&!(null==K?void 0:K.discussionStarted)&&(0,a.jsx)("div",{children:(0,a.jsx)("div",{className:"mt-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg",children:(0,a.jsx)("p",{className:"text-sm text-yellow-800",children:"Connection lost. Start discussion to reconnect"})})})]})})})]},"discussion")]})})]})};let J={id:"section-1",title:"Introduction to Machine Learning",content:"Machine learning is a subset of artificial intelligence that provides systems the ability to automatically learn and improve from experience without being explicitly programmed. \n\nIn this comprehensive introduction, we'll explore the fundamental concepts that make machine learning such a powerful tool in today's technology landscape. Machine learning focuses on the development of computer programs that can access data and use it to learn for themselves.\n\nThe process of learning begins with observations or data, such as examples, direct experience, or instruction, in order to look for patterns in data and make better decisions in the future based on the examples that we provide. The primary aim is to allow the computers to learn automatically without human intervention or assistance and adjust actions accordingly.\n\nKey concepts we'll cover include supervised learning, where algorithms learn from labeled training data; unsupervised learning, which finds hidden patterns in data without labeled examples; and reinforcement learning, where agents learn through interaction with their environment to maximize cumulative reward.",duration:480};function Y(){return(0,a.jsx)($,{section:J,onSectionComplete:()=>{console.log("Section completed!")}})}},6651:function(e,t,s){"use strict";var a=s(3827),n=s(4090),i=s(953);let r=(0,n.forwardRef)((e,t)=>{let{className:s,variant:n="primary",size:r="md",loading:l=!1,icon:o,children:c,disabled:d,...u}=e;return(0,a.jsxs)("button",{ref:t,className:(0,i.cn)("inline-flex items-center justify-center font-medium transition-colors rounded-md focus:outline-none focus:ring-2 focus:ring-offset-2",{primary:"bg-primary-600 text-white hover:bg-primary-700 focus:ring-primary-500",secondary:"bg-secondary-600 text-white hover:bg-secondary-700 focus:ring-secondary-500",outline:"border border-gray-300 bg-transparent text-gray-800 hover:bg-gray-50 focus:ring-primary-500",ghost:"bg-transparent text-gray-700 hover:bg-gray-100 focus:ring-gray-500",danger:"bg-error-600 text-white hover:bg-error-700 focus:ring-error-500"}[n],{sm:"px-3 py-1.5 text-sm",md:"px-4 py-2 text-base",lg:"px-6 py-3 text-lg"}[r],(d||l)&&"opacity-50 cursor-not-allowed pointer-events-none",s),disabled:d||l,...u,children:[l&&(0,a.jsxs)("svg",{className:"animate-spin -ml-1 mr-2 h-4 w-4 text-current",xmlns:"http://www.w3.org/2000/svg",fill:"none",viewBox:"0 0 24 24",children:[(0,a.jsx)("circle",{className:"opacity-25",cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"4"}),(0,a.jsx)("path",{className:"opacity-75",fill:"currentColor",d:"M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"})]}),o&&!l&&(0,a.jsx)("span",{className:"mr-2",children:o}),c]})});r.displayName="Button",t.Z=r},7418:function(e,t,s){"use strict";s.d(t,{Zb:function(){return i},aY:function(){return r}});var a=s(3827);s(4090);var n=s(953);let i=e=>{let{className:t,children:s,onClick:i,hover:r=!1}=e;return(0,a.jsx)("div",{className:(0,n.cn)("bg-white rounded-xl shadow-apple-sm border border-gray-100",r&&"transition-all duration-200 hover:shadow-apple-md hover:scale-[1.01]",i&&"cursor-pointer",t),onClick:i,children:s})},r=e=>{let{className:t,children:s}=e;return(0,a.jsx)("div",{className:(0,n.cn)("p-6 pt-0",t),children:s})}},8222:function(e,t,s){"use strict";s.d(t,{av:function(){return l}});var a=s(8009),n=s(1783);let i=s(2215).env.NEXT_PUBLIC_API_URL||"http://localhost:5000",r={get:async e=>{let t=await fetch("".concat(i).concat(e),{method:"GET",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("API Error: ".concat(t.statusText));return t.json()},post:async(e,t)=>{let s=await fetch("".concat(i).concat(e),{method:"POST",headers:{"Content-Type":"application/json"},body:t?JSON.stringify(t):void 0});if(!s.ok)throw Error("API Error: ".concat(s.statusText));return s.json()},postFormData:async(e,t)=>{let s=await fetch("".concat(i).concat(e),{method:"POST",body:t});if(!s.ok)throw Error("API Error: ".concat(s.statusText));return s.json()},delete:async e=>{let t=await fetch("".concat(i).concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"}});if(!t.ok)throw Error("API Error: ".concat(t.statusText));return t.json()}},l={getAll:async()=>{try{let e=await n.Z.get("http://localhost:5000/docs");if(200==e.status)return e.data}catch(n){var e,t,s;a.ZP.error(null!==(s=null==n?void 0:null===(t=n.response)||void 0===t?void 0:null===(e=t.data)||void 0===e?void 0:e.message)&&void 0!==s?s:"Failed to fetch documents")}},getById:e=>r.get("/documents/".concat(e)),getContent:e=>r.get("/documents/".concat(e,"/content")),upload:e=>{let t=new FormData;return t.append("file",e),r.postFormData("/documents/upload",t)},delete:e=>r.delete("/documents/".concat(e)),getChapters:async e=>{var t,s,i,r,l;try{let i=await n.Z.get("".concat("http://localhost:5000","/docs/").concat(e,"/chapters"));if(i.status.toString().startsWith("2"))return i.data;a.ZP.error(null!==(s=null==i?void 0:null===(t=i.data)||void 0===t?void 0:t.message)&&void 0!==s?s:"Failed to fetch chapters")}catch(e){a.ZP.error(null!==(l=null==e?void 0:null===(r=e.response)||void 0===r?void 0:null===(i=r.data)||void 0===i?void 0:i.message)&&void 0!==l?l:"Failed to fetch chapters")}},getSections:async(e,t)=>{var s,i,r,l,o;try{let r=await n.Z.get("".concat("http://localhost:5000","/docs/").concat(e,"/chapters/").concat(t));if(r.status.toString().startsWith("2"))return r.data;a.ZP.error(null!==(i=null==r?void 0:null===(s=r.data)||void 0===s?void 0:s.message)&&void 0!==i?i:"Failed to fetch Sections")}catch(e){a.ZP.error(null!==(o=null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)&&void 0!==o?o:"Failed to fetch chapters")}},getDiscussions:async(e,t)=>{var s,i,r,l,o;try{let r=await n.Z.get("".concat("http://localhost:5000","/docs/").concat(e,"/chapters/").concat(t,"/discussions"));if(r.status.toString().startsWith("2"))return r.data;a.ZP.error(null!==(i=null==r?void 0:null===(s=r.data)||void 0===s?void 0:s.message)&&void 0!==i?i:"Failed to fetch Discussion")}catch(e){a.ZP.error(null!==(o=null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)&&void 0!==o?o:"Failed to fetch Discussion")}},createDiscussion:async(e,t)=>{var s,i,r,l,o;try{let r=await n.Z.post("".concat("http://localhost:5000","/docs/").concat(e,"/chapters/").concat(t,"/discussions"),{});if(r.status.toString().startsWith("2"))return r.data;a.ZP.error(null!==(i=null==r?void 0:null===(s=r.data)||void 0===s?void 0:s.message)&&void 0!==i?i:"Failed to create Discussion")}catch(e){a.ZP.error(null!==(o=null==e?void 0:null===(l=e.response)||void 0===l?void 0:null===(r=l.data)||void 0===r?void 0:r.message)&&void 0!==o?o:"Failed to create Discussion")}}}},1783:function(e,t,s){"use strict";var a=s(3107);function n(e){if((null==e?void 0:e.status)===401){window.location.assign("/auth/signin");return}return e}function i(e){return e instanceof FormData?{headers:{"Content-Type":"multipart/form-data"},withCredentials:!0}:{headers:{"Content-Type":"application/json"},withCredentials:!0}}async function r(e,t){try{let s=await a.Z.post(e,t,i(t));return n(s)}catch(e){var s;if((null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.status)===401){window.location.assign("/auth/signin");return}}}async function l(e,t){try{let s=await a.Z.put(e,t,i(t));return n(s)}catch(e){var s;if((null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.status)===401){window.location.assign("/auth/signin");return}}}async function o(e,t){try{let s=await a.Z.patch(e,t,i(t));return n(s)}catch(e){var s;if((null==e?void 0:null===(s=e.response)||void 0===s?void 0:s.status)===401){window.location.assign("/auth/signin");return}}}async function c(e){try{let t=await a.Z.get(e,{withCredentials:!0});return console.log("lets see your status...",t.status),n(t)}catch(e){var t;if((null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)===401){window.location.assign("/auth/signin");return}}}async function d(e){try{let t=await a.Z.delete(e,{withCredentials:!0});return n(t)}catch(e){var t;if((null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)===401){window.location.assign("/auth/signin");return}}}async function u(e){try{let t=await a.Z.delete(e,{withCredentials:!0});return n(t)}catch(e){var t;if((null==e?void 0:null===(t=e.response)||void 0===t?void 0:t.status)===401){window.location.assign("/auth/signin");return}}}t.Z={post:r,get:c,put:l,del:u,patch:o,drop:d}},953:function(e,t,s){"use strict";s.d(t,{cn:function(){return i},p6:function(){return l},sS:function(){return r}});var a=s(3167),n=s(1367);function i(){for(var e=arguments.length,t=Array(e),s=0;s<e;s++)t[s]=arguments[s];return(0,n.m6)((0,a.W)(t))}function r(e){if(0===e)return"0 Bytes";let t=Math.floor(Math.log(e*=1024)/Math.log(1024));return parseFloat((e/Math.pow(1024,t)).toFixed(2))+" "+["Bytes","KB","MB","GB"][t]}function l(e){let t=new Date(e);return console.log("Provided date string:",{date:t,dateString:e}),new Intl.DateTimeFormat("en-US",{month:"short",day:"numeric",year:"numeric"}).format(t)}},2273:function(e,t,s){"use strict";s.d(t,{C:function(){return r},k:function(){return l}});var a=s(4090),n=s(7907);let i={};function r(){let[e,t]=(0,a.useState)(i),[s,r]=(0,a.useState)(!i),l=(0,n.useRouter)(),o=(0,n.usePathname)();return(0,a.useEffect)(()=>{(null==i?void 0:i.token)&&(null==i?void 0:i.user)||fetch("http://localhost:5000/auth/session",{credentials:"include",method:"GET",headers:{"Content-Type":"application/json"}}).then(async e=>{if(200==e.status){let s=await e.json();t(i={user:s.user,token:s.token})}else i={},t({}),"/"!==o&&l.push("/auth/signin")}).catch(e=>{console.error("Session fetch error:",e),t({}),"/"!==o&&l.push("/auth/signin")}).finally(()=>r(!1))},[]),{session:e,loading:s}}function l(){i={}}}},function(e){e.O(0,[490,316,107,99,971,69,744],function(){return e(e.s=8332)}),_N_E=e.O()}]);